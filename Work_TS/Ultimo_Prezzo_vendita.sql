SELECT DO11_DOCTESTATA.DO11_CLIFOR_CG44, DO30_DOCCORPO.DO30_CODART_MG66, MG73_ARTCLIFOR.MG73_ARTCLIFOR, DO30_DOCCORPO.DO30_DESCART, 
	(SELECT TOP 1 RORD2.DO30_PREZZO1  
		FROM DO30_DOCCORPO RORD2, DO11_DOCTESTATA ORD2 
		WHERE 
		RORD2.DO30_DITTA_CG18 = ORD2.DO11_DITTA_CG18 	AND
		RORD2.DO30_NUMREG_CO99 =  ORD2.DO11_NUMREG_CO99 AND 
		ORD2.DO11_CLIFOR_CG44 = DO11_DOCTESTATA.DO11_CLIFOR_CG44 AND 
		RORD2.DO30_CODART_MG66=DO30_DOCCORPO.DO30_CODART_MG66
		AND ORD2.DO11_DATADOC > '2009-01-01'
		ORDER BY ORD2.DO11_DATADOC DESC
	) AS ULTIMO_PRZ_VEND
FROM DO11_DOCTESTATA WITH (NOLOCK)
INNER JOIN DO30_DOCCORPO 	 WITH (NOLOCK) ON 
	DO30_DOCCORPO.DO30_DITTA_CG18 		= DO11_DOCTESTATA.DO11_DITTA_CG18 	AND
	DO30_DOCCORPO.DO30_NUMREG_CO99 		=  DO11_DOCTESTATA.DO11_NUMREG_CO99
LEFT OUTER JOIN MG73_ARTCLIFOR WITH (NOLOCK) ON
	MG73_ARTCLIFOR.MG73_DITTA_CG18 = DO11_DOCTESTATA.DO11_DITTA_CG18 AND
	MG73_ARTCLIFOR.MG73_CLIFOR_CG44 = DO11_DOCTESTATA.DO11_CLIFOR_CG44 AND
	MG73_ARTCLIFOR.MG73_CODART_MG66 = DO30_DOCCORPO.DO30_CODART_MG66
	AND MG73_TIPOCF_CG44 = 0

WHERE
DO30_DOCCORPO.DO30_CAUSMAG_MG51 = 2000 AND DO30_DOCCORPO.DO30_CODART_MG66 IS NOT NULL 
AND DO11_CLIFOR_CG44 = 5969 AND DO11_DOCTESTATA.DO11_DATADOC > '2009-01-01'

GROUP BY DO11_DOCTESTATA.DO11_CLIFOR_CG44, DO30_DOCCORPO.DO30_CODART_MG66, MG73_ARTCLIFOR.MG73_ARTCLIFOR, DO30_DOCCORPO.DO30_DESCART 
ORDER BY DO11_DOCTESTATA.DO11_CLIFOR_CG44