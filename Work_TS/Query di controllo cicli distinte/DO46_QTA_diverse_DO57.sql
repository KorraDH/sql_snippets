select DO11_NUMDOC, DO11_DOCUM_MG36, DO46_QTA1CONSOLID, 
	DO57_QTA1CONSOLID_SUM = (
		select SUM(DO57_QTA1CONSOLID) 
		from dbo.DO57_DETAVANZ 
		where DO57_DITTA_CG18=DO46_DITTA_CG18 AND DO57_NUMREG_CO99 = DO46_NUMREG_CO99 and DO57_PROGRIGA_DO46 = DO46_PROGRIGA AND DO57_PROGDET_DO46= DO46_PROGDET), 
DO46_CODSEQFASE, * from dbo.DO46_DOCCORORDDET 
INNER JOIN DO11_DOCTESTATA ON
DO11_DITTA_CG18=DO46_DITTA_CG18 AND
DO11_NUMREG_CO99=DO46_NUMREG_CO99
where 
DO46_NUMREG_CO99 LIKE '2012%' AND DO11_DOCUM_MG36 = 'P-ODL' AND DO46_QTA1CONSOLID > 0
AND DO46_INDFASEINTEST = 0 AND DO46_QTA1CONSOLID <> (
		select SUM(DO57_QTA1CONSOLID) 
		from dbo.DO57_DETAVANZ 
		where DO57_DITTA_CG18=DO46_DITTA_CG18 AND DO57_NUMREG_CO99 = DO46_NUMREG_CO99 and DO57_PROGRIGA_DO46 = DO46_PROGRIGA AND DO57_PROGDET_DO46= DO46_PROGDET)
ORDER BY 1, 5

/*
UPDATE DO46_DOCCORORDDET 
SET DO46_QTA1CONSOLID = (
		select SUM(DO57_QTA1CONSOLID) from dbo.DO57_DETAVANZ 
		where DO57_DITTA_CG18=DO46_DITTA_CG18 AND DO57_NUMREG_CO99 = DO46_NUMREG_CO99 and DO57_PROGRIGA_DO46 = DO46_PROGRIGA AND DO57_PROGDET_DO46= DO46_PROGDET)

FROM DO46_DOCCORORDDET 
INNER JOIN DO11_DOCTESTATA ON
DO11_DITTA_CG18=DO46_DITTA_CG18 AND
DO11_NUMREG_CO99=DO46_NUMREG_CO99
WHERE
DO11_DITTA_CG18=DO46_DITTA_CG18 AND
DO11_NUMREG_CO99=DO46_NUMREG_CO99 AND
DO46_NUMREG_CO99 LIKE '2011%' AND DO11_DOCUM_MG36 = 'P-ODL' AND DO46_QTA1CONSOLID > 0
AND DO46_INDFASEINTEST = 0 AND DO46_QTA1CONSOLID <> (
		select SUM(DO57_QTA1CONSOLID) 
		from dbo.DO57_DETAVANZ 
		where DO57_DITTA_CG18=DO46_DITTA_CG18 AND DO57_NUMREG_CO99 = DO46_NUMREG_CO99 and DO57_PROGRIGA_DO46 = DO46_PROGRIGA AND DO57_PROGDET_DO46= DO46_PROGDET) */